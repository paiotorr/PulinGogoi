<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Owner Panel – Clear Logs</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta http-equiv="X-Frame-Options" content="DENY" />
<meta http-equiv="X-Content-Type-Options" content="nosniff" />

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Arial,Helvetica,sans-serif;
  background:#f6f6f6;
  color:#000;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.panel{
  background:#fff;
  width:100%;
  max-width:420px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
  padding:24px;
  text-align:center;
}
h1{font-size:20px;margin-bottom:10px}
.note{font-size:13px;color:#555;margin-bottom:20px}
.count-box{
  background:#000;color:#fff;
  padding:14px;border-radius:8px;
  margin-bottom:18px;font-size:14px;
}
.count-box span{
  font-size:22px;font-weight:bold;
  display:block;margin-top:4px;
}
.clear-btn{
  width:100%;padding:12px;
  border:none;border-radius:24px;
  background:#c40000;color:#fff;
  font-size:14px;cursor:pointer;
}
.clear-btn:hover{background:#a30000}
.footer{margin-top:18px;font-size:12px;color:#777}
.logout-btn{
  margin-top:14px;
  background:#000;
  color:#fff;
  border:none;
  padding:10px 14px;
  border-radius:20px;
  cursor:pointer;
  font-size:13px;
}
</style>
</head>

<body>

<div class="panel">
  <h1>Owner – Clear Activity Logs</h1>

  <div class="note">
    Use this option <strong>before public launch</strong><br>
    to reset admin activity history.
  </div>

  <div class="count-box">
    Logs in Activity Panel
    <span id="logCount">0</span>
  </div>

  <button class="clear-btn" id="clearBtn">
    CLEAR ACTIVITY LOGS
  </button>

  <button class="logout-btn" id="logoutBtn">
    Logout
  </button>

  <div class="footer">
    JoiZubeenDa • Owner Control
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore, collection, getDocs, writeBatch, doc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ---------- Firebase config ----------
  const firebaseConfig = {
    apiKey: "AIzaSyC6cMfvfX68H-luCgPa32aXAc0D-x6bczU",
    authDomain: "zubeenda-17222.firebaseapp.com",
    projectId: "zubeenda-17222",
    storageBucket: "zubeenda-17222.firebasestorage.app",
    messagingSenderId: "541676751696",
    appId: "1:541676751696:web:e75867164d4372d3ad7a55"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const logCountEl = document.getElementById("logCount");
  const clearBtn = document.getElementById("clearBtn");
  const logoutBtn = document.getElementById("logoutBtn");

  // ---------- OWNER GUARD ----------
  onAuthStateChanged(auth, async (user) => {
    if(!user){
      sessionStorage.removeItem("jzd_session");
      location.replace("login.html");
      return;
    }

    try {
      const snap = await fetchUserRole(user.uid);
      if(snap !== "admin"){
        alert("Owner access only.");
        await signOut(auth);
        location.replace("login.html");
        return;
      }
      updateCount();
    } catch (err) {
      console.error(err);
      alert("Authorization failed.");
      await signOut(auth);
      location.replace("login.html");
    }
  });

  async function fetchUserRole(uid){
    const res = await getDocs(collection(db, "users"));
    let role = null;
    res.forEach(d => {
      if(d.id === uid) role = d.data().role;
    });
    return role;
  }

  // ---------- COUNT LOGS ----------
  async function updateCount(){
    const snap = await getDocs(collection(db, "activityLogs"));
    logCountEl.textContent = snap.size;
  }

  // ---------- CLEAR LOGS ----------
  clearBtn.addEventListener("click", async () => {
    if(!confirm("Are you sure you want to CLEAR ALL activity logs?")) return;
    if(!confirm("This action cannot be undone.\n\nConfirm clear?")) return;

    try {
      const snap = await getDocs(collection(db, "activityLogs"));
      const batch = writeBatch(db);
      snap.forEach(d => batch.delete(doc(db, "activityLogs", d.id)));
      await batch.commit();
      alert("Activity logs cleared successfully.");
      updateCount();
    } catch (err) {
      console.error(err);
      alert("Failed to clear logs.");
    }
  });

  // ---------- LOGOUT ----------
  logoutBtn.addEventListener("click", async () => {
    try { await signOut(auth); } catch(e){}
    sessionStorage.removeItem("jzd_session");
    location.replace("login.html");
  });

  // ---------- BASIC HARDENING ----------
  document.addEventListener("contextmenu", e => e.preventDefault());
  document.addEventListener("keydown", e => {
    if(e.keyCode===123 || (e.ctrlKey && e.shiftKey)){
      e.preventDefault();
    }
  });
</script>
<script>
// Disable Right Click
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});

// Disable Key Shortcuts
document.addEventListener('keydown', function(e) {

    // Block F12
    if (e.keyCode == 123) {
        e.preventDefault();
    }

    // Block Ctrl+Shift+I / Ctrl+Shift+J / Ctrl+U
    if (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) {
        e.preventDefault();
    }

    if (e.ctrlKey && e.keyCode == 85) {
        e.preventDefault();
    }

    // Block Ctrl+S, Ctrl+C,
    if (e.ctrlKey && (e.keyCode == 83 || e.keyCode == 67)) {
        e.preventDefault();
    }
});
</script>


</body>
</html>
