<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Owner Login - PAIOTORR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  * {
    box-sizing: border-box;
  }

  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(135deg, #e8edf5, #f7f9fc);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }

  .login-box {
    background: white;
    width: 100%;
    max-width: 360px;
    padding: 35px 30px;
    border-radius: 14px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.18);
    text-align: center;
  }

  h2 {
    margin: 0 0 25px 0;
    font-size: 22px;
    font-weight: 600;
    color: #222;
  }

  input {
    width: 100%;
    padding: 12px 14px;
    margin-top: 14px;
    border-radius: 8px;
    border: 1px solid #d0d6e0;
    font-size: 14px;
    transition: border 0.2s, box-shadow 0.2s;
  }

  input:focus {
    outline: none;
    border-color: #0b6efd;
    box-shadow: 0 0 0 2px rgba(11, 110, 253, 0.15);
  }

  /* --- FIX: REMOVE BROWSER DEFAULT EYE --- */
  /* This hides the native eye button in Edge/Internet Explorer */
  input::-ms-reveal,
  input::-ms-clear {
    display: none;
  }
  /* --------------------------------------- */

  /* --- PASSWORD CONTAINER STYLES --- */
  .password-wrapper {
    position: relative;
    width: 100%;
    margin-top: 14px;
  }

  .password-wrapper input {
    margin-top: 0; 
    padding-right: 40px; 
  }

  .toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    cursor: pointer;
    color: #6c757d;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    outline: none;
  }

  .toggle-password:hover {
    color: #0b6efd;
  }
  
  .toggle-password svg {
    width: 20px;
    height: 20px;
  }

  button.login-btn-main {
    width: 100%;
    padding: 12px;
    margin-top: 22px;
    background: #0b6efd;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 500;
    transition: background 0.2s, transform 0.1s;
  }

  button.login-btn-main:hover:not(:disabled) {
    background: #095bd1;
  }

  button.login-btn-main:active:not(:disabled) {
    transform: scale(0.98);
  }

  button.login-btn-main:disabled {
    background: #9aa4b2;
    cursor: not-allowed;
  }

  .message {
    margin-top: 15px;
    font-size: 13px;
    min-height: 16px;
    color: #d93025;
  }
</style>
</head>
<body>

<div class="login-box">
  <h2>PAIOTORR</h2>

  <input id="email" type="email" placeholder="Owner Email" autocomplete="username">
  
  <div class="password-wrapper">
    <input id="password" type="password" placeholder="Password" autocomplete="current-password">
    <button type="button" id="togglePassword" class="toggle-password" tabindex="-1">
      <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
    </button>
  </div>

  <button id="loginBtn" class="login-btn-main">Login</button>

  <div id="msg" class="message"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('togglePassword');
    const passInputEl = document.getElementById('password');

    toggleBtn.addEventListener('click', function(e) {
      e.preventDefault(); 
      
      const type = passInputEl.getAttribute('type') === 'password' ? 'text' : 'password';
      passInputEl.setAttribute('type', type);
      
      if (type === 'text') {
        this.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:20px;height:20px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88" />
          </svg>`;
      } else {
        this.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:20px;height:20px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>`;
      }
    });
  });
</script>

<script type="module">
import { auth } from '/firebase.js';
import { signInWithEmailAndPassword } from
  "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const MAX_ATTEMPTS = 3;
const LOCK_TIME = 10 * 60 * 1000;

const emailInput = document.getElementById("email");
const passInput = document.getElementById("password");
const msg = document.getElementById("msg");
const loginBtn = document.getElementById("loginBtn");

function now() {
  return new Date().getTime();
}

function getLockData() {
  return JSON.parse(localStorage.getItem("ownerLoginLock") || "{}");
}

function setLockData(data) {
  localStorage.setItem("ownerLoginLock", JSON.stringify(data));
}

function isLocked() {
  const data = getLockData();
  return data.lockUntil && now() < data.lockUntil;
}

function lockFor10Min() {
  setLockData({
    attempts: MAX_ATTEMPTS,
    lockUntil: now() + LOCK_TIME
  });
}

function incrementAttempts() {
  const data = getLockData();
  const attempts = (data.attempts || 0) + 1;

  if (attempts >= MAX_ATTEMPTS) {
    lockFor10Min();
    return MAX_ATTEMPTS;
  } else {
    setLockData({ attempts });
    return attempts;
  }
}

function resetAttempts() {
  localStorage.removeItem("ownerLoginLock");
}

function showLockMessage() {
  const data = getLockData();
  const remaining = Math.ceil((data.lockUntil - now()) / 60000);
  msg.innerText = `Too many attempts. Try again in ${remaining} minute(s).`;
  loginBtn.disabled = true;
}

function updateLockUI() {
  if (isLocked()) {
    showLockMessage();
    return true;
  } else {
    loginBtn.disabled = false;
    return false;
  }
}

updateLockUI();

window.login = function () {
  if (updateLockUI()) return;

  const email = emailInput.value.trim();
  const pass = passInput.value;

  if (!email || !pass) {
    msg.innerText = "Please enter email and password.";
    return;
  }

  msg.innerText = "Checking login...";

  signInWithEmailAndPassword(auth, email, pass)
   .then(async (userCredential) => {
  resetAttempts();

  const user = userCredential.user;
  const uid = user.uid;

  const { getFirestore, doc, getDoc } = await import(
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
  );

  const db = getFirestore();
  const userRef = doc(db, "users", uid);
  const snap = await getDoc(userRef);

  if (!snap.exists()) {
    msg.innerText = "Access denied. User role not found.";
    return;
  }

  const role = snap.data().role;

  if (role === "owner") {
    window.location.replace("/Zubeen Da/admin.html");
  } else if (role === "team") {
    window.location.replace("/Zubeen Da/videoAdd.html");
  } else {
    msg.innerText = "Invalid user role.";
  }
})
    .catch((error) => {
      console.error(error);
      const tries = incrementAttempts();

      if (tries >= MAX_ATTEMPTS) {
        showLockMessage();
      } else {
        msg.innerText = `Wrong login. Attempts left: ${MAX_ATTEMPTS - tries}`;
      }
    });
};

setInterval(() => {
  if (!isLocked()) {
    loginBtn.disabled = false;
    msg.innerText = "";
  }
}, 5000);

loginBtn.addEventListener("click", login);
</script>
 
 <script>
// Disable Right Click
document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
});

// Disable Key Shortcuts
document.addEventListener('keydown', function(e) {

    // Block F12
    if (e.keyCode == 123) {
        e.preventDefault();
    }

    // Block Ctrl+Shift+I / Ctrl+Shift+J / Ctrl+U
    if (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) {
        e.preventDefault();
    }

    if (e.ctrlKey && e.keyCode == 85) {
        e.preventDefault();
    }

    // Block Ctrl+S, Ctrl+C, Ctrl+A
    if (e.ctrlKey && (e.keyCode == 83 || e.keyCode == 67 || e.keyCode == 65)) {
        e.preventDefault();
    }
});
</script>

</body>
</html>
