<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Paiotorr â€“ Owner Dashboard</title>

<style>
body{
  margin:0;
  padding:20px;
  font-family:Arial, sans-serif;
  background:#ffffff;
}

h1{ margin-bottom:16px; }

/* FILTER */
.filter{
  display:flex;
  gap:10px;
  align-items:center;
  margin-bottom:20px;
}

.filter input{
  padding:8px;
  font-size:15px;
}

.filter button{
  padding:9px 14px;
  font-size:15px;
  font-weight:bold;
  border:none;
  border-radius:6px;
  cursor:pointer;
}

.apply{ background:#000; color:#fff; }
.clear{ background:#777; color:#fff; }

/* LAYOUT */
.layout{
  display:grid;
  grid-template-columns: 2fr 1fr;
  gap:20px;
}

/* SECTIONS */
.section{
  border-radius:12px;
  padding:16px;
  border:2px solid #ddd;
}

.pending{ border-color:#f1c40f; }
.accepted{ border-color:#2ecc71; }
.rejected{ border-color:#e74c3c; }

.section h2{ margin-top:0; }

/* ORDER CARD */
.order{
  border:2px solid #ccc;
  border-radius:10px;
  padding:14px;
  margin-bottom:14px;
}

.header{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}

.table{ font-size:18px; font-weight:bold; }
.time{ font-size:14px; color:#555; }

.customer{
  font-size:15px;
  font-weight:bold;
  margin-bottom:6px;
}

.item{
  display:flex;
  justify-content:space-between;
  font-size:15px;
  margin-bottom:4px;
}

.total{
  font-size:17px;
  font-weight:bold;
  margin-top:6px;
}

/* ACTIONS */
.actions button{
  padding:10px 14px;
  font-size:15px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-right:8px;
}

.acceptBtn{ background:#2ecc71; color:#fff; }
.rejectBtn{ background:#e74c3c; color:#fff; }

/* STATUS */
.status{
  font-size:20px;
  font-weight:bold;
  margin-top:8px;
}
.ok{ color:#2ecc71; }
.no{ color:#e74c3c; }
</style>
</head>

<body>

<h1>ðŸ“‹ Paiotorr â€“ Owner</h1>

<!-- DATE FILTER -->
<div class="filter">
  <input type="date" id="fromDate">
  <input type="date" id="toDate">
  <button class="apply" onclick="applyFilter()">Apply</button>
  <button class="clear" onclick="clearFilter()">Clear</button>
</div>

<div class="layout">

  <!-- LEFT: PENDING -->
  <div class="section pending">
    <h2>ðŸŸ¡ Pending Orders</h2>
    <div id="pending"></div>
  </div>

  <!-- RIGHT -->
  <div>
    <div class="section accepted">
      <h2>ðŸŸ¢ Accepted</h2>
      <div id="accepted"></div>
    </div>

    <br>

    <div class="section rejected">
      <h2>ðŸ”´ Rejected</h2>
      <div id="rejected"></div>
    </div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore,
  collection,
  onSnapshot,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyDSf51jWs3I4AXX0U8M_HxKn4VtRYg72xs",
  authDomain:"hotel-order-7f1f2.firebaseapp.com",
  projectId:"hotel-order-7f1f2"
});
const db = getFirestore(app);

const pendingDiv  = document.getElementById("pending");
const acceptedDiv = document.getElementById("accepted");
const rejectedDiv = document.getElementById("rejected");

let allOrders = [];

/* LIVE LOAD */
onSnapshot(collection(db,"orders"), snap=>{
  allOrders = [];
  snap.forEach(d=> allOrders.push({id:d.id, ...d.data()}));
  render(allOrders);
});

/* APPLY DATE FILTER (Accepted & Rejected only) */
window.applyFilter = ()=>{
  const f = document.getElementById("fromDate").value;
  const t = document.getElementById("toDate").value;
  if(!f || !t) return alert("Select both dates");

  const from = new Date(f);
  const to = new Date(t);
  to.setHours(23,59,59);

  const filtered = allOrders.filter(o=>{
    if(o.status === "pending") return true;
    const d = new Date(o.time);
    return d >= from && d <= to;
  });

  render(filtered);
};

window.clearFilter = ()=>{
  document.getElementById("fromDate").value="";
  document.getElementById("toDate").value="";
  render(allOrders);
};

/* RENDER */
function render(list){
  pendingDiv.innerHTML="";
  acceptedDiv.innerHTML="";
  rejectedDiv.innerHTML="";

  list.forEach(o=>{
    let items="";
    o.items.forEach(i=>{
      items+=`<div class="item">
        <span>${i.name} Ã— ${i.qty}</span>
        <span>â‚¹${i.price * i.qty}</span>
      </div>`;
    });

    const card = `
      <div class="order">
        <div class="header">
          <div class="table">Table ${o.table}</div>
          <div class="time">${o.time}</div>
        </div>
        <div class="customer">ðŸ‘¤ ${o.customer}</div>
        ${items}
        <div class="total">Total: â‚¹${o.total}</div>
        ${
          o.status==="pending"
          ? `<div class="actions">
              <button class="acceptBtn" onclick="setStatus('${o.id}','accepted')">Accept</button>
              <button class="rejectBtn" onclick="setStatus('${o.id}','rejected')">Reject</button>
            </div>`
          : `<div class="status ${o.status==='accepted'?'ok':'no'}">
              ${o.status==='accepted'?'âœ” ACCEPTED':'âœ– REJECTED'}
            </div>`
        }
      </div>`;

    if(o.status==="pending") pendingDiv.innerHTML += card;
    if(o.status==="accepted") acceptedDiv.innerHTML += card;
    if(o.status==="rejected") rejectedDiv.innerHTML += card;
  });
}

/* ACTIONS */
window.setStatus = async (id,status)=>{
  await updateDoc(doc(db,"orders",id),{ status });
};
</script>

</body>
</html>